---
title: "Test case Rainfall pipeline La Corona"
format: html
editor: visual
---

## Introduction

This notebook demonstrates the different functions that have been developed to analyse and check the rainfall data from La Corona, based on the original work from Prof Chip Cheshier and Prof Francois Birgand at North Carolina State University.

Scripts and functions have been developed as part of FPTA 358 funded by INIA Uy.

This document specifically focuses on the analysis of the rainfall data

## packages

To be able to run this notebook, the following R packages should be available

```{r message = FALSE}
library(tidyverse)
library(plotly)
#library(readxl)
#library(htmlwidgets)
```

## Loading the developed functions

The functions are stored in the scripts folder, the same folder as the code version of this file (the \*.qmd file).

```{r loadfunctions}
source("Functions_Rain.R")

```

We can now list all the functions that have been loaded using:

```{r listfunctions}
print(lsf.str())
```

## Testing the different functions

The first test is using the automatic file read function. The `read_list_files` function will read a list of files from the directory given. It is embedded in the `process_rain_data_auto` function, but first the functionality will be demonstrated.

```{r read_file_list}
files <- read_list_files("../All_Raw_data/T042223/Rain")
files
```

The list that has been generated by this function can be used to read in the different rainfall files using the `read_data_file` function. Again, this is embedded in a loop in the overall `process_rain_data_auto` function, but here is the functionality.

```{r showreaddata}
name <- files$names[3]
file_path <- files$paths[[which(files$names==name)]]

test_data <- read_data_file(name, file_path)
test_data

```

### Automatic processing across all files

We can now test the full functionality of `process_rain_data_auto` on the files. Note that this runs across all the files in the folder and writes them out as OTIP files.

I am putting the output in a "processed" folder.

```{r autoVersion}
file_path_in <- "../All_Raw_data/T042223/Rain"

test_files <- process_rain_data_auto(file_path = file_path_in, output_path_add = "processed")
```

### Manual input and processing

This tests the version that asks for user input (the file name) before processing.

```{r manualVersion}

file_path_in <- "../Rain"

test_manual <- process_rain_data(file_path_in)
```

```         
 "EM061523.csv" "R1061523.csv" "R7061523.csv"
```

## Quick check plot

The next step is to make a plot to check the data. Use the function `quick_check_plot`. The function has two arguments. The first argument points to the path where the processed files are stored. The second argument `file_numbers`, can be "all", meaning, plot all files in the folder, or can be a number or sequene of numbers, meaning the ordered number of the file in the folder (stored alphabetically and numerical sorted).

First create a list with all the processed data files using `create_data_list`

```{r createdatalist}
data_processed <- create_data_list(path_to_processed = "../ALl_Raw_data/T042223/Rain/processed")
```

We can now make the plots, first plot 1

```{r makeplot1}
check_plot(data_processed)

```

and plot 2

```{r makeplot2}
check_plot(data_processed, plot = 2)
```

Add a plot to compare pluviometers against each other?
