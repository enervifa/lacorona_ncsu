---
title: "Testing Flume pipeline scripts La Corona"
format: html
editor: visual
---

## Introduction

This notebook demonstrates the different functions that have been developed to analyse and check the field data from La Corona, based on the original work from Prof Chip Cheshier and Prof Francois Birgand at North Carolina State University.

Scripts and functions have been developed as part of FPTA 358 funded by INIA Uy.

This document specifically focuses on the analysis of the streamflow data

## packages

To be able to run this notebook, the following R packages should be available

```{r message = FALSE}
library(tidyverse) 
library(plotly) 
library(readxl) 
library(htmlwidgets)
```

## Loading the developed functions

The functions are stored in the scripts folder, the same folder as the code version of this file (the \*.qmd file).

```{r loadfunctions}
source("Functions_Flumes.R") 
```

testing the functions

Read in the files

```{r read-files}
File_info <- read_list_flume("../flumes")
str(File_info)
```

Lets' also test the manual read of S1110119.csv (don't use quotes)

Testing the HOBOU20 function

```{r}
test_info <- read_flume_files(file_path = "../flumes")
test_info
```

Now we can check the processing of the files, for the manual file

```{r}
test_data <- file_process(test_info$names[1], test_info$paths[1],
                          test_info$instrument[1], output_dir = "../flumes/processed")
ggplotly(test_data$plot)
```

### Stevens

More challenging, testing the `read_stevens` function: filename V4111219.csv

```{r}
test_info_stevens <- read_flume_files(file_path = "../flumes")
test_info_stevens
```

Now process

```{r}
test_data_stevens <- file_process(test_info_stevens$names[1], 
                                 file_path =test_info_stevens$paths[1],
                          instrument = test_info_stevens$instrument[1], 
                          output_dir = "../flumes/processed")
test_data_stevens$data
```

### ISCO files

There are two types of ISCO files, one with velocity values, the other with level values.

Need to adjust the `read_isco` function to differentiate between these two

```{r}
process_and_plot_files(file_info = File_info, output_dir = "../flumes/processed")
```

```{r}
getwd()
```
